-- ============================================================================
-- MOTTU - Migração para Tabelas de Zona
-- Compatível com Oracle 12c+ (IDENTITY)
-- ============================================================================
-- Este script cria as tabelas de Zona que não existem no modelo Oracle original
-- mas são necessárias para o frontend que trabalha com "3 zonas com X vagas"
-- ============================================================================

-- 1) TABELA TB_ZONA
CREATE TABLE TB_ZONA (
  id_zona        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome           VARCHAR2(50) NOT NULL,
  data_entrada   DATE NOT NULL,
  data_saida     DATE NOT NULL,
  observacao     VARCHAR2(100),
  criado_em      TIMESTAMP DEFAULT SYSTIMESTAMP
);

COMMENT ON TABLE  TB_ZONA IS 'Zonas do pátio para organização de boxes/vagas';
COMMENT ON COLUMN TB_ZONA.nome IS 'Nome da zona (ex: Zona A, Zona B, Zona C)';

-- 2) TABELA TB_ZONAPATIO (junção Zona x Pátio)
CREATE TABLE TB_ZONAPATIO (
  id_zona        NUMBER NOT NULL,
  id_patio       NUMBER NOT NULL,
  criado_em      TIMESTAMP DEFAULT SYSTIMESTAMP,
  CONSTRAINT pk_zona_patio PRIMARY KEY (id_zona, id_patio),
  CONSTRAINT fk_zp_zona FOREIGN KEY (id_zona) REFERENCES TB_ZONA(id_zona),
  CONSTRAINT fk_zp_patio FOREIGN KEY (id_patio) REFERENCES TB_PATIO(id_patio)
);

COMMENT ON TABLE TB_ZONAPATIO IS 'Junção Zona x Pátio (muitos-para-muitos)';

-- 3) TABELA TB_ZONABOX (junção Zona x Box)
CREATE TABLE TB_ZONABOX (
  id_zona        NUMBER NOT NULL,
  id_box         NUMBER NOT NULL,
  criado_em      TIMESTAMP DEFAULT SYSTIMESTAMP,
  CONSTRAINT pk_zona_box PRIMARY KEY (id_zona, id_box),
  CONSTRAINT fk_zb_zona FOREIGN KEY (id_zona) REFERENCES TB_ZONA(id_zona),
  CONSTRAINT fk_zb_box FOREIGN KEY (id_box) REFERENCES TB_BOX(id_box)
);

COMMENT ON TABLE TB_ZONABOX IS 'Junção Zona x Box (muitos-para-muitos)';

-- 4) ÍNDICES para performance
CREATE INDEX ix_zona_nome ON TB_ZONA (nome);
CREATE INDEX ix_zona_patio_zona ON TB_ZONAPATIO (id_zona);
CREATE INDEX ix_zona_patio_patio ON TB_ZONAPATIO (id_patio);
CREATE INDEX ix_zona_box_zona ON TB_ZONABOX (id_zona);
CREATE INDEX ix_zona_box_box ON TB_ZONABOX (id_box);

-- 5) DADOS INICIAIS (opcional - 3 zonas padrão)
INSERT INTO TB_ZONA (nome, data_entrada, data_saida, observacao) VALUES 
('Zona A', SYSDATE, DATE '2099-12-31', 'Zona principal do pátio'),
('Zona B', SYSDATE, DATE '2099-12-31', 'Zona secundária do pátio'),
('Zona C', SYSDATE, DATE '2099-12-31', 'Zona terciária do pátio');

COMMIT;
