# ==================================================
# Spring Boot Application Configuration
# ==================================================

# --- Application Name and .env Import ---
spring.application.name=mottu-gradle

# --- Server Configuration ---
# Configuração de porta dinâmica - encontra automaticamente uma porta livre
# Se 8080 estiver ocupada, tenta 8081, 8082, etc.
server.port=${PORT:8080}
server.servlet.context-path=/

# --- Port Management Configuration ---
# Permite que o Spring Boot encontre automaticamente uma porta livre
spring.main.web-application-type=servlet

# --- Oracle DataSource Configuration (FIAP REMOTO - comentado) ---
# spring.datasource.url=jdbc:oracle:thin:@//oracle.fiap.com.br:1521/ORCL
# spring.datasource.username=rm557881
# spring.datasource.password=fiap25
# spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# --- HikariCP Connection Pool Settings ---
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL
spring.datasource.hikari.auto-commit=false

spring.output.ansi.enabled=ALWAYS

# --- Perfil e banco LOCAL ---
spring.profiles.active=dev
spring.datasource.url=jdbc:oracle:thin:@//localhost:1521/XEPDB1
spring.datasource.username=relacaoDireta
spring.datasource.password=paulo1
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver

# --- JPA / Hibernate Configuration ---
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.OracleDialect
spring.jpa.properties.hibernate.id.new_generator_mappings=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false

# --- Oracle Sequence Configuration ---
spring.jpa.properties.hibernate.id.optimizer.pooled.prefer_lo=true
spring.jpa.properties.hibernate.id.optimizer.pooled.increment_size=1
spring.jpa.properties.hibernate.id.optimizer.pooled.initial_value=1

# --- Oracle Specific Settings ---
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.connection.autocommit=false
spring.jpa.properties.hibernate.schema=RELACAODIRETA
spring.jpa.properties.hibernate.default_schema=RELACAODIRETA
spring.jpa.properties.hibernate.connection.username=relacaoDireta
spring.jpa.properties.hibernate.connection.password=paulo1
spring.jpa.properties.hibernate.connection.url=jdbc:oracle:thin:@//localhost:1521/XEPDB1

# --- HTTP Error Response Details ---
server.error.include-stacktrace=always
server.error.include-message=always
server.error.include-exception=true

# --- Logging Levels ---
logging.level.root=INFO
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.data.jpa=DEBUG
logging.level.org.springframework.security=TRACE
logging.level.org.springframework.security.web=TRACE
logging.level.org.springframework.security.authentication=TRACE
logging.level.org.hibernate.type.descriptor.sql=TRACE
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=DEBUG
logging.level.org.hibernate.tool.schema.internal.SchemaCreatorImpl=DEBUG
logging.level.org.hibernate.dialect.Dialect=DEBUG
logging.level.org.hibernate.resource.jdbc=DEBUG
logging.level.br.com.fiap.mottu=DEBUG
logging.level.oracle=DEBUG
logging.level.com.zaxxer.hikari=DEBUG

# --- CORS Debug Logging ---
logging.level.org.springframework.web.cors=TRACE
logging.level.org.springframework.web.servlet.handler.AbstractHandlerMapping=TRACE
logging.level.org.springframework.web.servlet.DispatcherServlet=TRACE
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping=TRACE

# --- Controller Debug Logging ---
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter=TRACE
logging.level.org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver=TRACE

# --- Bean Loading Debug ---
logging.level.org.springframework.context.annotation.AnnotationConfigApplicationContext=TRACE
logging.level.org.springframework.beans.factory.support.DefaultListableBeanFactory=TRACE
logging.level.org.springframework.context.annotation.ConfigurationClassPostProcessor=TRACE

# --- HTTP Request/Response Debug ---
logging.level.org.springframework.web.servlet.FrameworkServlet=TRACE
logging.level.org.apache.catalina.core.ContainerBase=TRACE
logging.level.org.apache.catalina.core.StandardWrapper=TRACE

# --- MOTTU Specific Debug ---
logging.level.br.com.fiap.mottu.controller=TRACE
logging.level.br.com.fiap.mottu.service=TRACE
logging.level.br.com.fiap.mottu.config=TRACE
logging.level.br.com.fiap.mottu.mapper=TRACE
logging.level.br.com.fiap.mottu.repository=TRACE

# --- Network and HTTP Debug ---
logging.level.org.apache.coyote.http11=TRACE
logging.level.org.apache.tomcat.util.net=TRACE
logging.level.org.apache.catalina.connector=TRACE
logging.level.org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping=TRACE

# --- Request/Response Headers Debug ---
logging.level.org.springframework.web.servlet.mvc.method.annotation.HttpEntityMethodProcessor=TRACE
logging.level.org.springframework.http.converter=TRACE

# ==================================================
# *** CORRE��O: AUMENTAR LIMITE DE UPLOAD ***
# ==================================================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ==================================================
# *** OpenALPR (Windows Local) ***
# ==================================================
# Caminho ABSOLUTO do execut�vel no Windows (use barras duplas!)
mottu.ocr.alpr.command=alpr
# use EU enquanto n�o existir br.conf/br.xml
mottu.ocr.alpr.region=eu
mottu.ocr.alpr.topn=10
mottu.ocr.alpr.minConfidence=70
mottu.ocr.alpr.timeoutMs=30000
mottu.ocr.alpr.debugOutputDir=logs

# ==================================================
# *** Configurações de OCR ***
# ==================================================
# Desabilitar Tesseract para usar apenas OpenALPR
mottu.ocr.tessdata-path=
mottu.ocr.lang=por+eng

# ==================================================
# *** Health Checks Customizados ***
# ==================================================
# Endpoints de health check customizados:
# - GET /api/health - Health check geral
# - GET /api/health/database - Health check do banco de dados  
# - GET /api/health/system - Informações do sistema

